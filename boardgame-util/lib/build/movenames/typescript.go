package movenames

import (
	"strings"
	"unicode"
)

//GenerateTypeScript produces the contents of a _move_names.ts file given a
//list of move names.
func GenerateTypeScript(moveNames []string) string {

	if len(moveNames) == 0 {
		return typeScriptHeader + typeScriptEmptyBody
	}

	var b strings.Builder

	b.WriteString(typeScriptHeader)
	b.WriteString("export const MoveNames = {\n")

	for _, name := range moveNames {
		key := toPascalCase(name)
		b.WriteString("  ")
		b.WriteString(key)
		b.WriteString(": \"")
		b.WriteString(name)
		b.WriteString("\",\n")
	}

	b.WriteString("} as const;\n")
	b.WriteString("\n")
	b.WriteString("export type MoveName = typeof MoveNames[keyof typeof MoveNames];\n")

	return b.String()
}

//toPascalCase converts a move name like "Reveal Card" to "RevealCard".
//It splits on whitespace, strips non-alphanumeric characters, capitalizes the
//first letter of each word, and joins.
func toPascalCase(name string) string {
	words := strings.Fields(name)
	var b strings.Builder

	for _, word := range words {
		// Strip non-alphanumeric characters
		var cleaned []rune
		for _, r := range word {
			if unicode.IsLetter(r) || unicode.IsDigit(r) {
				cleaned = append(cleaned, r)
			}
		}
		if len(cleaned) == 0 {
			continue
		}
		// Capitalize first letter, keep rest as-is
		cleaned[0] = unicode.ToUpper(cleaned[0])
		b.WriteString(string(cleaned))
	}

	return b.String()
}

const typeScriptHeader = `/*
 * Auto-generated by boardgame-util. DO NOT EDIT.
 */

`

const typeScriptEmptyBody = `export const MoveNames = {} as const;

export type MoveName = typeof MoveNames[keyof typeof MoveNames];
`
